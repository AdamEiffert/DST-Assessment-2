---
title: "03-labelling conn.log"
output: html_document
---

### Matching snort to conn
First, we select a random sample of 200,000 data points. This was limited by the time taken to label the data using the snort logs. The original plan was to label all of the conn.log data, however this was unfeasible time-wise even with multiple optimisations in place.
```{r}
set.seed(56)
random_sample1 <- conn[sample(1:nrow(conn),200000),]
```

Now for each of the snort log entries, we check to see if any entries in our random sample match, in which case they are labelled at malicious and their attack type is noted. Here we used the criteria of time, src and dst IP addresses and (if available) src and dst Ports. 
```{r}
cl <- makeCluster(8, type="SOCK") # for 8 cores machine
registerDoSNOW (cl)

for (j in c(1:nrow(snort))){
  if (snort$Port[j]){
    random_sample1[random_sample1$ts == snort$ts[j] & random_sample1$srcIP == snort$srcIP[j] & random_sample1$dstIP == snort$dstIP[j] & random_sample1$srcPort == snort$srcPort[j] & random_sample1$dstPort == snort$dstPort[j], ':=' ('malicious'=TRUE,'atcktype'=snort$type[j])]
  }else{
    random_sample1[random_sample1$ts == snort$ts[j] & random_sample1$srcIP == snort$srcIP[j] & random_sample1$dstIP == snort$dstIP[j],':=' ('malicious'=TRUE,'atcktype'=snort$type[j])]
  }
}
```
We now save this random sample to a file.
```{r}
write.csv(random_sample1,'../data/processed/labelled.csv')
```
